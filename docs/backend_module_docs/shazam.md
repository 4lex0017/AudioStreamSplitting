# Shazam

This class provides functionality to access the [Shazam API](https://rapidapi.com/apidojo/api/shazam) to identify a segment of song data.

## Contents

Public functions:

- [``lookup``](#lookup)

Private functions:

- [``_lookup_segment_with_offset``](#_lookup_segment_with_offset)
- [``_format_song_data``](#_format_song_data)
- [``_get_song_data_segment``](#_get_song_data_segment)
- [``_create_payload_from_song_data``](#_create_payload_from_song_data)
- [``_send_lookup_request``](#_send_lookup_request)
- [``_extract_value_from_metadata``](#_extract_value_from_metadata)

## Public functions

### lookup

Attempt to identify the given song using the [Shazam API](https://rapidapi.com/apidojo/api/shazam). If the song can't be recognised from the first segment, step through it until the segment ends or a result is found.

#### lookup:Arguments

- ``song_data: numpy.ndarray``: The song data. Must be at a sample rate of 44100Hz.
- ``apikey: str``: The API key.
- ``from_start: bool = True``: Whether to start attempting to identify snippets of the given song from the beginning or the ending.

#### lookup:Returns

- If matches are found: The retrieved metadata as a ``dict``, with the keys ``"title"``, ``"artist"``, ``"album"`` and ``"year"`` for the respective metadata.
- ``None`` otherwise.

## Private functions

While these functions aren't "private" in the sense that they cannot be accessed from the outside, they should not be called from outside this file.

### _lookup_segment_with_offset

Look up a snippet of the given song at the given offset.

#### _lookup_segment_with_offset:Arguments

- ``song_data: numpy.ndarray``: The song data. Must be at a sample rate of 44100Hz.
- ``apikey: str``: The API key.
- ``offset: int``: The offset the snippet should start at, in seconds.

#### _lookup_segment_with_offset:Returns

Tuple ``(matches, track)`` of the retrieved metadata, matching the sections of the API response with the same name.

### _format_song_data

Format the song data as a mono int16 array.

#### _format_song_data:Arguments

- ``song_data: numpy.ndarray``: The song data.

#### _format_song_data:Returns

``numpy.ndarray`` containing the formatted data.

### _get_song_data_segment

Get a segment of the song data at the given offset.

#### _get_song_data_segment:Arguments

- ``song_data: numpy.ndarray``: The song data.
- ``offset: int``: The offset the snippet should start at, in seconds.

#### _get_song_data_segment:Returns

``numpy.ndarray`` containing just the desired segment.

### _create_payload_from_song_data

Create the payload to include with the request in the Shazam API's data format (A base64-encoded byte array).

#### _create_payload_from_song_data:Arguments

- ``song_data: numpy.ndarray``: The song data.

#### _create_payload_from_song_data:Returns

``str`` containing the payload.

### _send_lookup_request

Send the actual lookup request to the [Shazam API](https://rapidapi.com/apidojo/api/shazam).

#### _send_lookup_request:Arguments

- ``payload: str``: The payload as generated by [``_create_payload_from_song_data``](#_create_payload_from_song_data).
- ``apikey``: The Shazam API key.

#### _send_lookup_request:Returns

``requests.Response`` containing the request response.

### _extract_value_from_metadata

Extract a value from the response's "Metadata" section.

#### _extract_value_from_metadata:Arguments

- ``track: list``: The "track" segment of the API response.
- ``key: str``: The key to search for in the metadata.

#### _extract_value_from_metadata:Returns

``str`` containing the value if it exists, or nothing otherwise.
